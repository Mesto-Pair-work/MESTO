(()=>{"use strict";var e={baseUrl:"https://nomoreparties.co/v1/plus-cohort-15",headers:{authorization:"d3efd322-579e-46e2-8334-d27c812c6b90","Content-Type":"application/json"}};function t(e){var t=document.querySelector(".profile__photo"),o=document.querySelector(".profile__full-name"),n=document.querySelector(".profile__occupation");t.src=e.avatar,o.textContent=e.name,n.textContent=e.about}var o,n=(o=function(e,t){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?t.disabled=!1:t.disabled=!0},{enableValidation:function(e){Array.from(document.querySelectorAll(e.formSelector)).forEach((function(t){!function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),r=e.querySelector(t.submitButtonSelector);o(n,r),n.forEach((function(c){c.addEventListener("input",(function(){!function(e,t,o){t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),t.validity.valid?function(e,t,o){var n=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(o.inputErrorClass),n.classList.remove(o.errorClass),n.textContent=""}(e,t,o):function(e,t,o,n){var r=e.querySelector(".".concat(t.id,"-error"));t.classList.add(n.inputErrorClass),r.textContent=o,r.classList.add(n.errorClass)}(e,t,t.validationMessage,o)}(e,c,t),o(n,r)}))}))}(t,e)}))}});function r(e){e.classList.add("popup_opened")}function c(e){e.classList.remove("popup_opened"),e.querySelector(".popup__form")&&(e.querySelector(".popup__form").reset(),e.classList.remove())}function a(t,o){t.userId=o,document.querySelector(".places__items").prepend(function(t){var o=document.querySelector(".popup_type_big-photo"),n=o.querySelector(".popup__big-img"),c=o.querySelector(".popup__title_type_big-photo"),a=document.querySelector("#templateCard").content.querySelector(".places-box").cloneNode(!0),u=a.querySelector(".places-box__emotion"),i=a.querySelector(".places-box__photo"),s=a.querySelector(".places-box__name"),l=a.querySelector(".places-box__like-num");i.src=t.link,i.alt=t.name,s.textContent=t.name,l.textContent=t.likes.length;var p=a.querySelector(".places-box__like");if(t.likes.find((function(e){return e._id===t.userId}))&&p.classList.add("places-box__like_active"),p.addEventListener("click",(function(){var o;this.classList.toggle("places-box__like_active"),this.classList.contains("places-box__like_active")?(o=t._id,fetch("".concat(e.baseUrl,"/cards/likes/").concat(o),{method:"PUT",headers:e.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(e){l.textContent=e.likes.length})).catch((function(e){console.log(e)})):function(t){return fetch("".concat(e.baseUrl,"/cards/likes/").concat(t),{method:"DELETE",headers:e.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))}(t._id).then((function(e){l.textContent=e.likes.length})).catch((function(e){console.log(e)}))})),t.owner._id===t.userId){var d=document.createElement("button");d.setAttribute("type","button"),d.setAttribute("aria-label","del-card"),d.className="places-box__del-card",u.append(d),d.addEventListener("click",(function(){var o;confirm("Вы уверены, что хотите удалить эту карточку?")&&(a.remove(),o=t._id,fetch("".concat(e.baseUrl,"/cards/").concat(o),{method:"DELETE",headers:e.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})))}))}return i.addEventListener("click",(function(){n.src=t.link,n.alt=t.name,c.textContent=t.name,r(o)})),a}(t))}var u=document.querySelectorAll(".popup"),i=document.querySelector(".profile__edit-btn"),s=document.querySelector(".profile__edit-avatar"),l=document.querySelector(".profile__button-plus"),p=document.querySelector(".popup_type_profile"),d=document.querySelector(".popup_type_new-place"),_=document.querySelector(".popup_type_avatar"),f=_.querySelector(".popup__form"),m=p.querySelector(".popup__form"),h=d.querySelector(".popup__form"),y=p.querySelector(".popup__inp_field_fullname"),v=p.querySelector(".popup__inp_field_occupation"),S=d.querySelector(".popup__inp_field_newplacelink"),b=d.querySelector(".popup__inp_field_newplacename"),q=_.querySelector(".popup__inp_field_avatar"),k=document.querySelector(".profile__full-name"),C=document.querySelector(".profile__occupation");i.addEventListener("click",(function(){r(p),y.value=k.textContent,v.value=C.textContent})),m.addEventListener("submit",(function(o){var n;m.querySelector(".popup__save-btn").textContent="Сохранение...",o.preventDefault(),(n={name:y.value,about:v.value},fetch("".concat(e.baseUrl,"/users/me"),{method:"PATCH",headers:e.headers,body:JSON.stringify({name:n.name,about:n.about})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(e){t(e),m.querySelector(".popup__save-btn").textContent="Сохранить",c(p)})).catch((function(e){console.log(e)}))})),l.addEventListener("click",(function(){r(d)})),h.addEventListener("submit",(function(t){var o;h.querySelector(".popup__save-btn").textContent="Сохранение...",t.preventDefault(),(o={name:b.value,link:S.value},fetch("".concat(e.baseUrl,"/cards"),{method:"POST",headers:e.headers,body:JSON.stringify({name:o.name,link:o.link})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(e){a(e,e.owner._id),h.querySelector(".popup__save-btn").textContent="Сохранить",c(d)})).catch((function(e){console.log(e)}))})),s.addEventListener("click",(function(){r(_)})),f.addEventListener("submit",(function(o){var n;f.querySelector(".popup__save-btn").textContent="Сохранение...",o.preventDefault(),(n=q.value,fetch("".concat(e.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:e.headers,body:JSON.stringify({avatar:n})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(e){t(e),f.querySelector(".popup__save-btn").textContent="Обновить",c(_)})).catch((function(e){console.log(e)}))})),u.forEach((function(e){document.addEventListener("keydown",(function(t){"Escape"===t.key&&c(e)})),e.addEventListener("mousedown",(function(t){t.target===e&&c(e)})),e.addEventListener("click",(function(t){t.target===e.querySelector(".popup__close-btn")&&c(e)}))})),fetch("".concat(e.baseUrl,"/cards"),{headers:e.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(o){fetch("".concat(e.baseUrl,"/users/me"),{headers:e.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){t(e),o.forEach((function(t){a(t,e._id)}))}))})).catch((function(e){console.log(e)})),n.enableValidation({formSelector:".popup__form",inputSelector:".popup__inp",submitButtonSelector:".popup__save-btn",inputErrorClass:"popup__input_type_error",errorClass:"popup__inp-error_active"})})();